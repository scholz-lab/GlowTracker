#:kivy 2.0


# main Window has 3 columns
# left most is settings  and setting displays
# middle is the image window
# right most is opening dialogs



MainWindow:
    size: root.size
    pos: root.pos
    id: maingrid
    cols: 3
    rows: 2
    padding: [10,10,10,10]
    spacing: 10
    MyLabel:
        id: title
        text: 'Macroscope GUI'
        font_size: 42
        size_hint: (0.4, 0.15)
    MyLabel:
        size_hint: (0.5, 0.15)
    MyLogo:
        size_hint: (0.1,0.15)
    LeftColumn:
    MiddleColumn:
    RightColumn:

# popup confirming closing
<ExitApp>:
    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
            on_release: root.cancel()

        Button:
            text: "Close"
            on_release: root.stop()

#################################
# Left column
#################################
<LeftColumn>:
    size_hint: (0.3,1)
    orientation: 'vertical'
    pos: root.pos
    spacing: 5
    saveloc: saveloc
    MyLabel: 
        text: 'Stage Controls'
    XControls:
    YControls:
    ZControls:
    MyButton:
        text: 'Autofocus'
        pos_hint: {'x': 0.25}
    MyLabel: 
        text: 'Camera Settings'
    CameraProperties:
    MyButton:
        text: 'Load camera settings'
        pos_hint: {'x': 0.25}
        on_release: root.show_save()
        
    MyLabel: 
        text: 'Experiment'
    TextInput:
        id: saveloc
        size_hint_y: None
        height: 30
        multiline: False
        text: "Startup"
    MyButton:
        text: 'Save Location'
        pos_hint: {'x': 0.25}
        on_release: root.show_save()
    
        
        

### Display camera properties

<CameraProperties>:
    cols: 2
    rows: 3
    Label:
        text: 'Exposure (us)'
    TextInput:
        input_filter: 'int'
    Label: 
        text: 'Framerate (fps)'
    TextInput:
        input_filter: 'int'
    Label:
        text: 'Gain'
    TextInput:
        input_filter: 'int'
        

    
#################################
# Stage motion buttons
#################################

<StageButtonLeftFast@Button>:
    size_hint: .5, .9
    pos_hint: {"x":0.1, "y":0.1}
    background_normal: 'icons/LeftButtonNormal_Double.jpg'
    background_down: 'icons/LeftButtonOnPress_Double.jpg'
    
<StageButtonLeft@Button>:
    size_hint: .25, .9
    pos_hint: {"x":0.1, "y":0.1}
    background_normal: 'icons/LeftButtonNormal.jpg'
    background_down: 'icons/LeftButtonOnPress.jpg'
    
<StageButtonRightFast@Button>:
    size_hint: .5, .9
    pos_hint: {"x":0.1, "y":0.1}
    background_normal: 'icons/RightButtonNormal_Double.jpg'
    background_down: 'icons/RightButtonOnPress_Double.jpg'
    
<StageButtonRight@Button>:
    size_hint: .25, .9
    pos_hint: {"x":0.1, "y":0.1}
    background_normal: 'icons/RightButtonNormal.jpg'
    background_down: 'icons/RightButtonOnPress.jpg'

<XControls>:
    BoxLayout:
        orientation: 'horizontal'
        size: root.size
        pos: root.pos
        StageButtonLeftFast:            
            on_press: root.moveX_bigStepLeft()
        StageButtonLeft:
            on_press: root.moveX_smallStepLeft()
        Label:
            text: 'X'
            font_size: 40
            size_hint: (0.2,1)
        StageButtonRight:
            on_press: root.moveX_smallStepRight()
        StageButtonRightFast:            
            on_press: root.moveX_bigStepRight()

<YControls>:
    BoxLayout:
        orientation: 'horizontal'
        size: root.size
        pos: root.pos
        StageButtonLeftFast:            
            on_press: root.moveY_bigStepLeft()
        StageButtonLeft:
            on_press: root.moveY_smallStepLeft()
        Label:
            text: 'Y'
            valign: 'bottom'
            font_size: 40
            size_hint: (0.2,1)
        StageButtonRight:
            on_press: root.moveY_smallStepRight()
        StageButtonRightFast:            
            on_press: root.moveY_bigStepRight()
            
            
<ZControls>:
    BoxLayout:
        orientation: 'horizontal'
        size: root.size
        pos: root.pos
        StageButtonLeftFast:            
            on_press: root.moveZ_bigStepLeft()
        StageButtonLeft:
            on_press: root.moveZ_smallStepLeft()
        Label:
            text: 'Z'
            font_size: 40
            size_hint: (0.2,1)
        StageButtonRight:
            on_press: root.moveZ_smallStepRight()
        StageButtonRightFast:            
            on_press: root.moveZ_bigStepRight()

#################################
# Load camera properties - Popup
#################################
<LoadCameraProperties>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)
                
#################################
# save location experiment - Popup
#################################
<SaveExperiment>:
    rows: 2
    cols:1
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''
        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, text_input.text)        

            
            
#################################
# Middle column
#################################
<MiddleColumn>:
    size: root.size
    pos: root.pos
    size_hint: (0.6,1)
    GridLayout:
        cols: 1
        rows: 2
        PreviewImage:
        RuntimeControls:
        
### live camera image
<PreviewImage>:
    BoxLayout:
        size_hint: (0.6, 0.85)

### toggle tracking or autofocus
<RuntimeControls>:
    size_hint: (0.6,0.15)
    RecordButtons:
    GridLayout:
        cols: 2
        rows: 2
        MyLabel:
            text: 'Autofocus'
            color: '#ffffff'
        CheckBox:
        MyLabel:
            text: 'Tracking'
            color: '#ffffff'
        CheckBox:



### Live view and Record
<RecordButtons>:
    orientation: 'horizontal'
    spacing: 30
    padding: [80,10]
    Button:
        border: 0,0,0,0
        size_hint_x: 0.1
        size_hint_y: None
        height: self.width 
        pos_hint: {'center_x': .5, 'center_y': .5}
        background_normal: 'icons/play_off.png'
        background_down: 'icons/play_on.png'
    Button: 
        border: 0,0,0,0
        size_hint_x: 0.1
        size_hint_y: None
        height: self.width 
        pos_hint: {'center_x': .5, 'center_y': .5}
        background_normal: 'icons/record_inactive.png'
        background_down: 'icons/record_active.png'


#################################
# Right column
#################################
<RightColumn>:
    size: root.size
    pos: root.pos
    orientation: "vertical"
    size_hint: (0.1, 1)
    MyLabel:
        text: 'Settings'
        size_hint: (1, 0.1)
    MyButton:
        size_hint: (1, 0.1)
        text: 'Camera'
    MyButton:
        size_hint: (1, 0.1)
        text: 'Recording'
    MyButton:
        size_hint: (1, 0.1)
        text: 'Stage'
    MyButton:
        size_hint: (1, 0.1)
        text: 'LEDs'
    MyLabel:
        text: 'Hardware'
        size_hint: (1, 0.1)
    Connections:
        size_hint: (1,0.2)
 

### display if hardware is connected successfully     
<Connections>:
    orientation: 'vertical'
    size_hint: (0.3, 1)
    Label:
        text: 'Camera'
        size_hint: (1,0.5)
    OnOffButton:
        border: 0,0,0,0
        size_hint_x: 0.3
        size_hint_y: None
        height: self.width 
        pos_hint: {'center_x': .5, 'center_y': .5}
        #pos_hint: {"x":0.5, "y":0.0}
        background_normal: 'icons/connection_off.png'
        background_down: 'icons/connection_on.png'
    Label:
        text: 'Stage'
        size_hint: (1,0.5)
    OnOffButton:
        border: 0,0,0,0
        size_hint_x: 0.3
        size_hint_y: None
        height: self.width 
        pos_hint: {'center_x': .5, 'center_y': .5}
        #pos_hint: {"x":0.5, "y":0.0}
        background_normal: 'icons/connection_off.png'
        background_down: 'icons/connection_on.png'
    
        
      
#################################
# Layout settings - custom
#################################
<MyButton@Button>:
    #size: self.texture_size
    size_hint: (0.5, 0.5)
    font_size: 18
    halign: 'center'
    

<MyLabel@Label>:
    #size: self.texture_size
    size_hint: (1, 1)
    font_size: 18
    halign: 'center'
    color: '#8e0045ff'
    
    
<MyLogo@Image>:
    keep_ratio: True
    source: 'icons/logoSq.png'
    

<OnOffButton@ToggleButton>  
    background_normal: 'icons/connection_off.png'
    background_down: 'icons/connection_on.png'
    
            

